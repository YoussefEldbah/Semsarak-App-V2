<div class="admin-user-details-container">
  <div *ngIf="loading" class="admin-users-table-placeholder">
    <i class="fas fa-spinner fa-spin me-2"></i> Loading user details...
  </div>
  <div *ngIf="error && !loading" class="custom-alert custom-alert-danger animate__animated animate__fadeInDown">
    <span class="custom-alert-icon"><i class="fas fa-exclamation-circle"></i></span>
    <span class="custom-alert-text">{{ error }}</span>
    <span class="custom-alert-close" (click)="error = ''">&times;</span>
  </div>
  <div *ngIf="!loading && !error && user" class="admin-user-card">
    <div class="admin-user-header">
      <i class="fas fa-user-circle fa-3x text-primary"></i>
      <div class="admin-user-title">{{ user.userName || user.username }}</div>
      <div class="admin-user-role">
        <span *ngIf="user.roles && user.roles.length; else singleRole">
          <span *ngFor="let role of user.roles; let last = last">
            <span class="badge bg-info text-dark">{{ role }}</span><span *ngIf="!last">, </span>
          </span>
        </span>
        <ng-template #singleRole>
          <span class="badge bg-info text-dark">{{ user.role }}</span>
        </ng-template>
      </div>
    </div>
    <div class="admin-user-info-list">
      <div><strong>Email:</strong> <span>{{ user.email }}</span></div>
      <div *ngIf="user.phoneNumber"><strong>Phone Number:</strong> <span>{{ user.phoneNumber }}</span></div>
      <div *ngIf="user.nationalId"><strong>National ID:</strong> <span>{{ user.nationalId }}</span></div>
      <div><strong>User ID:</strong> <span>{{ user.id }}</span></div>
      <div *ngIf="user.createdAt || user.creationDate"><strong>Created At:</strong> <span>{{ user.createdAt || user.creationDate }}</span></div>
      <div *ngIf="user.lastLogin"><strong>Last Login:</strong> <span>{{ user.lastLogin }}</span></div>
      <div *ngIf="user.status"><strong>Account Status:</strong> <span>{{ user.status }}</span></div>
    </div>
    <div *ngIf="user.roles ? !user.roles.includes('Admin') : user.role !== 'Admin'" class="admin-user-role-change mt-4">
      <label for="roleSelect" class="form-label"><strong>Change User Role:</strong></label>
      <select id="roleSelect" class="form-select d-inline-block w-auto" [(ngModel)]="newRole" [disabled]="isChangingRole">
        <option value="" disabled selected>Select new role</option>
        <option value="Renter">Renter</option>
        <option value="Owner">Owner</option>
      </select>
      <button class="btn btn-primary ms-2" (click)="changeUserRole()" [disabled]="!newRole || isChangingRole">
        <span *ngIf="!isChangingRole"><i class="fas fa-exchange-alt me-1"></i> Change Role</span>
        <span *ngIf="isChangingRole"><i class="fas fa-spinner fa-spin me-1"></i> Changing...</span>
      </button>
    </div>
    <div *ngIf="user.roles ? user.roles.includes('Admin') : user.role === 'Admin'" class="admin-user-role-change mt-4">
      <div class="alert alert-info">This user is an <strong>Admin</strong>. The Admin role cannot be changed.</div>
    </div>
    <a routerLink="/admin" class="btn btn-outline-primary mt-3"><i class="fas fa-arrow-left me-1"></i> Back to Users</a>
    <button class="btn btn-danger mt-3 ms-2" (click)="openDeleteModal()" [disabled]="isDeleting">
      <i class="fas fa-trash me-1"></i> Delete User
    </button>
    <div *ngIf="successMessage" class="custom-alert custom-alert-success animate__animated animate__fadeInDown mt-3">
      <span class="custom-alert-icon"><i class="fas fa-check-circle"></i></span>
      <span class="custom-alert-text">{{ successMessage }}</span>
      <span class="custom-alert-close" (click)="successMessage = ''">&times;</span>
    </div>
    <div *ngIf="error && !loading" class="custom-alert custom-alert-danger animate__animated animate__fadeInDown mt-3">
      <span class="custom-alert-icon"><i class="fas fa-exclamation-circle"></i></span>
      <span class="custom-alert-text">{{ error }}</span>
      <span class="custom-alert-close" (click)="error = ''">&times;</span>
    </div>
    <div *ngIf="showDeleteModal" class="modal-overlay">
      <div class="custom-modal animate__animated animate__zoomIn">
        <div class="modal-icon"><i class="fas fa-exclamation-triangle"></i></div>
        <div class="modal-title">Delete User</div>
        <div class="modal-message">Are you sure you want to delete this user? This action cannot be undone.</div>
        <div class="modal-actions">
          <button class="btn btn-danger" (click)="confirmDeleteUser()" [disabled]="isDeleting">
            <i class="fas fa-trash me-1"></i> Delete
          </button>
          <button class="btn btn-secondary ms-2" (click)="closeDeleteModal()" [disabled]="isDeleting">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</div> 